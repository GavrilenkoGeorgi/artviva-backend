(this["webpackJsonpbloglist-frontend"]=this["webpackJsonpbloglist-frontend"]||[]).push([[0],{41:function(e,t,n){e.exports=n(71)},70:function(e,t,n){},71:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(17),u=n.n(c),s=n(2),o=n(11),l=n(14),i=Object(s.b)((function(e){return{notification:e.notification}}))((function(e){var t=e.notification;return r.a.createElement("div",{hidden:!t,style:{border:"solid",padding:10,borderWidth:1}},t)})),d=function(e,t){return function(n){n({type:"SET_NOTIFICATION",data:e}),setTimeout((function(){n({type:"SET_NOTIFICATION",data:null})}),1e3*t)}},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_NOTIFICATION":return e=t.data;case"RESET":return t.data;default:return e}},m=n(1),p=n.n(m),b={setNotification:d},E=Object(s.b)((function(e){return{user:e.user}}),b)((function(e){var t=e.setNotification;return r.a.createElement("button",{type:"button","data-cy":"logoutBtn",onClick:function(e){return p.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:e.preventDefault();try{window.localStorage.removeItem("loggedUserJSON"),document.location.href="/",t("Successfully logged out.",3)}catch(a){t(a.message,3)}case 2:case"end":return n.stop()}}))}},"Logout")})),g={setNotification:d},v=Object(s.b)((function(e){return{user:e.user}}),g)((function(e){var t=e.user;return r.a.createElement(r.a.Fragment,null,r.a.createElement(o.b,{to:"/"},"home"),r.a.createElement(o.b,{to:"/users"},"users"),r.a.createElement(o.b,{to:"/blogs"},"blogs"),t.username," logged in",r.a.createElement(E,null))})),h=n(4),y=n(18),O=function(e){var t=Object(a.useState)(""),n=Object(y.a)(t,2),r=n[0],c=n[1];return{type:e,value:r,onChange:function(e){c(e.target.value)},reset:function(){c("")}}},w=n(40),j=n(39),x=n(9),S=n.n(x),N="/api/blogs",I=null,T=function(){var e;return p.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.awrap(S.a.get(N));case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}}))},L=function(e){I="bearer ".concat(e)},B=function(e){var t,n;return p.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t={headers:{Authorization:I}},n=S.a.post(N,e,t),a.abrupt("return",n.then((function(e){return e.data})));case 3:case"end":return a.stop()}}))},_=function(e){var t,n;return p.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t={headers:{Authorization:I}},n=S.a.delete("".concat(N,"/").concat(e),t),a.abrupt("return",n.then((function(e){return e.data})));case 3:case"end":return a.stop()}}))},U=function(e,t){var n,a;return p.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return n={headers:{Authorization:I}},r.next=3,p.a.awrap(S.a.post("".concat(N,"/").concat(e,"/comments"),t,n));case 3:return a=r.sent,r.abrupt("return",a.data);case 5:case"end":return r.stop()}}))},k=function(e){var t,n;return p.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t={headers:{Authorization:I}},n=S.a.put("".concat(N,"/").concat(e.id),e,t),a.abrupt("return",n.then((function(e){return e.data})));case 3:case"end":return a.stop()}}))},C=function(){return function(e){var t;return p.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p.a.awrap(T());case 2:t=n.sent,e({type:"INIT_BLOGS",data:t});case 4:case"end":return n.stop()}}))}},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CREATE_BLOG":return[].concat(Object(j.a)(e),[t.data]);case"DELETE_BLOG":return e.filter((function(e){return e.id!==t.data}));case"INIT_BLOGS":return t.data;case"COMMENT":var n=t.data.blog,a=e.find((function(e){return e.id===n})),r=Object(w.a)({},a,{comments:a.comments.concat(t.data)});return e.map((function(e){return e.id!==n?e:r}));case"ADD_LIKE":var c=t.data;return c.likes++,e.map((function(e){return e.id!==t.data.id?e:c}));default:return e}},D={createBlog:function(e){return function(t){var n;return p.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,p.a.awrap(B(e));case 2:n=a.sent,t({type:"CREATE_BLOG",data:n});case 4:case"end":return a.stop()}}))}},setNotification:d},A=Object(s.b)((function(e){return{user:e.user}}),D)((function(e){var t=O("text"),n=t.reset,c=Object(h.a)(t,["reset"]),u=O("text"),s=u.reset,o=Object(h.a)(u,["reset"]),l=O("text"),i=l.reset,d=Object(h.a)(l,["reset"]);Object(a.useEffect)((function(){L(e.user.token)}),[e.user]);return r.a.createElement("div",null,r.a.createElement("h2",null,"Blog add form"),r.a.createElement("form",{onSubmit:function(t){t.preventDefault();var a={title:c.value,author:o.value,url:d.value,likes:0};e.createBlog(a).then((function(){e.setNotification("Blog added",5)})).catch((function(t){console.log(t),e.setNotification(t.message,5)})),n(""),s(""),i("")}},r.a.createElement("label",null,"Title"),r.a.createElement("input",Object.assign({"data-cy":"newTitle"},c)),r.a.createElement("br",null),r.a.createElement("label",null,"Author"),r.a.createElement("input",Object.assign({"data-cy":"newAuthor"},o)),r.a.createElement("br",null),r.a.createElement("label",null,"Url"),r.a.createElement("input",Object.assign({"data-cy":"newUrl"},d)),r.a.createElement("br",null),r.a.createElement("button",{"data-cy":"createBlog",type:"submit"},"create")))})),R=function(e){var t;return p.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p.a.awrap(S.a.post("/api/login",e));case 2:return t=n.sent,n.abrupt("return",t.data);case 4:case"end":return n.stop()}}))},G=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":case"SET_USER_FROM_LS":return t.user;default:return e}},J={login:function(e){var t=e.email,n=e.password;return function(e){var a;return p.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,p.a.awrap(R({email:t,password:n}));case 2:a=r.sent,e({type:"LOGIN",user:a});case 4:case"end":return r.stop()}}))}},setNotification:d},z=Object(s.b)((function(e){return{user:e.user}}),J)((function(e){var t=O("email"),n=t.reset,a=Object(h.a)(t,["reset"]),c=O("password"),u=c.reset,s=Object(h.a)(c,["reset"]);return r.a.createElement("form",{"data-cy":"loginForm",onSubmit:function(t){var r;return p.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t.preventDefault(),r={email:a.value,password:s.value},e.login(r).then((function(){e.setNotification("Logged in successfully",5)})).catch((function(t){var n=JSON.parse(t.request.responseText);e.setNotification(n.error,5)})),n(""),u("");case 5:case"end":return c.stop()}}))}},r.a.createElement("h4",null,"Login into application"),r.a.createElement("div",null,"email",r.a.createElement("input",Object.assign({},a,{name:"email","data-cy":"emailInput"}))),r.a.createElement("div",null,"password",r.a.createElement("input",Object.assign({},s,{name:"password","data-cy":"passwordInput"}))),r.a.createElement("button",{type:"submit","data-cy":"login"},"login"))})),M=function(){var e;return p.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.awrap(S.a.get("/api/users"));case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}}))},q=function(e){var t;return p.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p.a.awrap(S.a.post("/api/users",e));case 2:return t=n.sent,n.abrupt("return",t.data);case 4:case"end":return n.stop()}}))},W={setNotification:d},K=Object(s.b)((function(e){return{user:e.user}}),W)((function(e){var t=O("text"),n=t.reset,a=Object(h.a)(t,["reset"]),c=O("email"),u=c.reset,s=Object(h.a)(c,["reset"]),o=O("password"),l=o.reset,i=Object(h.a)(o,["reset"]);return r.a.createElement("form",{"data-cy":"signUpForm",onSubmit:function(t){var r;return p.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t.preventDefault(),r={email:s.value,username:a.value,password:i.value},q(r).then((function(){e.setNotification("Signup successful",5),n(""),u(""),l(""),document.location.href="/"})).catch((function(t){var n=JSON.parse(t.request.responseText);e.setNotification(n.error,5)}));case 3:case"end":return c.stop()}}))}},r.a.createElement("h4",null,"New user sign up"),r.a.createElement("div",null,"email",r.a.createElement("input",Object.assign({},s,{name:"email"}))),r.a.createElement("div",null,"username",r.a.createElement("input",Object.assign({},a,{name:"name"}))),r.a.createElement("div",null,"password",r.a.createElement("input",Object.assign({},i,{name:"password"}))),r.a.createElement("button",{type:"submit","data-cy":"signup"},"sign up"))})),Y=r.a.forwardRef((function(e,t){var n=Object(a.useState)(!1),c=Object(y.a)(n,2),u=c[0],s=c[1],o={display:u?"none":""},l={display:u?"":"none"},i=function(){s(!u)};return Object(a.useImperativeHandle)(t,(function(){return{toggleVisibility:i}})),r.a.createElement("div",null,r.a.createElement("div",{style:o},r.a.createElement("button",{"data-cy":e.dataCy,onClick:i},e.buttonLabel)),r.a.createElement("div",{style:l},e.children,r.a.createElement("button",{onClick:i},"cancel")))})),H={addLike:function(e){return console.log("Blog sent in reducer: ",e),function(t){var n;return p.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,p.a.awrap(k(e));case 2:n=a.sent,console.log("Updated blog: ",n),t({type:"ADD_LIKE",data:n});case 5:case"end":return a.stop()}}))}},deleteBlog:function(e){return function(t){return p.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p.a.awrap(_(e));case 2:t({type:"DELETE_BLOG",data:e});case 3:case"end":return n.stop()}}))}},setNotification:d},V=Object(s.b)((function(e){return{user:e.user}}),H)((function(e){var t=e.blog,n=Object(h.a)(e,["blog"]);Object(a.useEffect)((function(){L(n.user.token)}),[n.user]);return r.a.createElement("div",{style:{border:"solid",borderWidth:1,padding:5,margin:5}},r.a.createElement("div",null,r.a.createElement(o.b,{to:"/blogs/".concat(t.id)},t.title),t.author,r.a.createElement("div",{className:"more-info"},t.url,r.a.createElement("br",null),t.likes," likes",r.a.createElement("button",{type:"button",onClick:function(){return n.addLike(t)}},"like"),r.a.createElement("br",null),"added by ",t.author,r.a.createElement("br",null),"Author id is: ",t.user.username," ",r.a.createElement("br",null),"Current user id is: ",n.user.username," ",r.a.createElement("br",null),n.user.id===t.user.id&&r.a.createElement("button",{type:"button",onClick:function(){return e=t.id,void(window.confirm("Do you really want to delete blog with id of: ".concat(e,"?"))&&n.deleteBlog(e).catch((function(e){var t=JSON.parse(e.request.responseText);n.setNotification(t.error,5)})).finally(n.setNotification("Blog successfully deleted",5)));var e}},"delete"))))})),P={initializeBlogs:C},Q=Object(s.b)((function(e){return{blogs:e.blogs}}),P)((function(e){var t=e.blogs,n=Object(h.a)(e,["blogs"]);return Object(a.useEffect)((function(){n.initializeBlogs()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",null,"Blogs"),r.a.createElement("ul",null,t.map((function(e){return r.a.createElement(V,{key:e.id,blog:e})}))))})),X={comment:function(e){var t=e.blogId,n=Object(h.a)(e,["blogId"]);return function(e){var a;return p.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,p.a.awrap(U(t,n));case 2:a=r.sent,e({type:"COMMENT",data:a});case 4:case"end":return r.stop()}}))}},setNotification:d},Z=Object(s.b)((function(e){return{user:e.user}}),X)((function(e){var t=O("text"),n=t.reset,a=Object(h.a)(t,["reset"]);return r.a.createElement("form",{"data-testid":"comment-form",onSubmit:function(t){var r;return p.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t.preventDefault(),r={blogId:e.blogId,content:a.value},e.comment(r).then((function(){return e.setNotification("Comment added",5)})).catch((function(t){var n=JSON.parse(t.request.responseText);e.setNotification(n.error,5)})),n("");case 4:case"end":return c.stop()}}))}},r.a.createElement("div",null,"Your comment:",r.a.createElement("input",a)),r.a.createElement("button",{type:"submit"},"Comment"))})),$={initializeBlogs:C},ee=Object(s.b)((function(e,t){return{blogs:e.blogs,blog:(n=t.blogId,a=e.blogs,a.find((function(e){return e.id===n})))};var n,a}),$)((function(e){var t=e.blog,n=Object(h.a)(e,["blog"]);return t?r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",null,"Single blog!"),r.a.createElement("p",null,t.title," - ",r.a.createElement("strong",null,t.author)),r.a.createElement("div",null,r.a.createElement(Z,{blogId:t.id}),r.a.createElement("h3",null,"Comments"),r.a.createElement("ul",null,t.comments.map((function(e){return r.a.createElement("li",{key:e.id},e.content)}))))):(n.initializeBlogs(),r.a.createElement(r.a.Fragment,null,"just a sec.."))})),te=function(e){var t=e.userData;return r.a.createElement("div",null,r.a.createElement("span",null,r.a.createElement(o.b,{to:"/users/".concat(t.id)},t.username),"\xa0"),r.a.createElement("span",null,t.blogs.length))},ne=function(){return function(e){var t;return p.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p.a.awrap(M());case 2:t=n.sent,e({type:"GET_USERS_LIST",data:t});case 4:case"end":return n.stop()}}))}},ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_USERS_LIST":case"GET_USER_BY_ID":return t.data;default:return e}},re={getUsersList:ne},ce=Object(s.b)((function(e){return{users:e.users}}),re)((function(e){return Object(a.useEffect)((function(){e.getUsersList()}),[]),e.users?r.a.createElement("div",null,r.a.createElement("h3",null,"Users"),r.a.createElement("ul",null,e.users.map((function(e){return r.a.createElement(te,{key:e.id,userData:e})})))):r.a.createElement("h4",null,"just a sec..")})),ue={getUsersList:ne},se=Object(s.b)((function(e){return{users:e.users}}),ue)((function(e){var t,n=e.userId,a=Object(h.a)(e,["userId"]);if(a.users){var c=(t=n,a.users.find((function(e){return e.id===t}))).blogs;return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"user info ",n," "),c.map((function(e){return r.a.createElement("div",{key:e.id},e.title)})))}return a.getUsersList(),r.a.createElement("h4",null,"just a sec..")})),oe=(n(70),{setUserFromLocalStorage:function(e){return function(t){return p.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:t({type:"SET_USER_FROM_LS",user:e});case 1:case"end":return n.stop()}}))}}}),le=Object(s.b)((function(e){return{user:e.user}}),oe)((function(e){var t=r.a.createRef(),n=r.a.createRef();return Object(a.useEffect)((function(){if(e.user)window.localStorage.setItem("loggedUserJSON",JSON.stringify(e.user));else{var t=window.localStorage.getItem("loggedUserJSON");if(t){var n=JSON.parse(t);e.setUserFromLocalStorage(n)}else console.log("No user.")}}),[e,e.user,e.setUserFromLocalStorage]),r.a.createElement("div",{"data-testid":"main"},r.a.createElement(o.a,null,r.a.createElement(i,null),r.a.createElement("h1",null,"Blogs app."),e.user?r.a.createElement("div",null,r.a.createElement(v,null),r.a.createElement(l.a,{path:"/login",render:function(){return r.a.createElement(z,null)}}),r.a.createElement(l.a,{exact:!0,path:"/",render:function(){return r.a.createElement(Y,{buttonLabel:"new blog",dataCy:"addBlogFormToggle",ref:t},r.a.createElement(A,null))}}),r.a.createElement(l.a,{exact:!0,path:"/users",render:function(){return r.a.createElement(ce,null)}}),r.a.createElement(l.a,{exact:!0,path:"/users/:id",render:function(e){var t=e.match;return r.a.createElement(se,{userId:t.params.id})}}),r.a.createElement(l.a,{exact:!0,path:"/blogs",render:function(){return r.a.createElement(Q,null)}}),r.a.createElement(l.a,{exact:!0,path:"/blogs/:id",render:function(e){var t=e.match;return r.a.createElement(ee,{blogId:t.params.id})}})):r.a.createElement(r.a.Fragment,null,r.a.createElement(z,null),r.a.createElement(Y,{buttonLabel:"sign up",dataCy:"signUp",ref:n},r.a.createElement(K,null)))))})),ie=n(15),de=n(37),fe=n(38),me=Object(ie.combineReducers)({user:G,users:ae,blogs:F,notification:f}),pe=Object(ie.createStore)(me,Object(fe.composeWithDevTools)(Object(ie.applyMiddleware)(de.a))),be=function(){u.a.render(r.a.createElement(s.a,{store:pe},r.a.createElement(le,null)),document.getElementById("root"))};be(),pe.subscribe(be)}},[[41,1,2]]]);
//# sourceMappingURL=main.735b1b27.chunk.js.map